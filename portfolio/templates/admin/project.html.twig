{% extends 'base_admin.html.twig' %}

{% block title %}Ajout d'un projet{% endblock %}

{% form_theme form _self %}

{% block body %}

    <div class="container">
        <div class="row">
            <h2 class="text-uppercase  col-12 " style="border-bottom: 1px solid #fcd08a">Ajouter un projet</h2>

            <div class="section-contact col-12">
                {{ form_start(form) }}
                <div class=" d-flex align-items-center">
                    <div class="section-contact__icon-input d-flex justify-content-center align-items-center">
                        <i class="fas fa-heading"></i>
                    </div>
                    <label for="nom" class="d-inline w-100">
                        {{ form_widget(form.title) }}
                    </label>
                </div>
                <div class=" d-flex align-items-center">
                    <div class="section-contact__icon-input d-flex justify-content-center align-items-center">
                        <i class="fas fa-link"></i>
                    </div>
                    <label for="nom" class="d-inline w-100">
                        {{ form_widget(form.url) }}
                    </label>
                </div>

                <div class=" d-flex align-items-center">
                    <div class="section-contact__icon-input d-flex justify-content-center align-items-center">
                        <i class="far fa-image"></i>
                    </div>
                    <label for="nom" class="d-inline w-100">
                        {{ form_widget(form.cover) }}
                    </label>
                </div>

                <div class=" d-flex ">
                    <div class="section-contact__icon-input section-contact__icon-input--textarea d-flex justify-content-center align-items-center">
                        <i class="far fa-edit"></i>
                    </div>
                    <label for="nom" class="d-inline w-100">
                        {{ form_widget(form.description) }}
                    </label>
                </div>

                <div class=" d-flex align-items-center">
                    <div class="section-contact__icon-input d-flex justify-content-center align-items-center">
                        <i class="fas fa-quote-right"></i>
                    </div>
                    <label for="nom" class="d-inline w-100">
                        {{ form_widget(form.caption) }}
                    </label>
                </div>

                <div class=" d-flex align-items-center">
                    <div class="section-contact__icon-input d-flex justify-content-center align-items-center">
                        <i class="far fa-clock"></i>
                    </div>
                    <label for="nom" class="d-inline w-100">
                        {{ form_widget(form.date) }}
                    </label>
                </div>
                <div class=" d-flex ">
                    <div class="section-contact__icon-input section-contact__icon-input--select d-flex justify-content-center align-items-center">
                        <i class="far fa-edit"></i>
                    </div>
                    <label for="nom" class="d-inline w-100">
                        {{ form_widget(form.technologies) }}
                    </label>
                </div>

                {{ form_widget(form.pictures) }}
                <div class="text-right w-100">


                    {% if app.request.attributes.get('id') is null %}
                        <button  type="submit" class="mt-3"><i class="fas fa-check"></i> Valider</button>
                    {% else %}
                        <button  type="submit" class="mt-3"><i class="fas fa-check"></i> Modifier</button>
                    {% endif %}

                </div>


                {{ form_end(form) }}
            </div>

        </div>

    </div>

    <script>
        window.addEventListener("DOMContentLoaded", (event) => {
            let index = document.querySelectorAll('.image_add').length;
            document.getElementById('add-image').addEventListener('click',function (e){
                e.preventDefault();
                let area = document.getElementById('project_pictures');
                let prototype = area.dataset.prototype;
                index++;
                prototype = prototype.replace(/__name__/g,index);
                area.innerHTML = prototype + '<hr>' + area.innerHTML;
                loadListener();


            });
            loadListener();

            function loadListener(){
                let buttonsDelete = document.querySelectorAll('.del-image');

                for (i=0 ; i<buttonsDelete.length ; i++){
                    buttonsDelete[i].addEventListener('click',function (e){
                        e.preventDefault();
                        console.log('click')
                        document.getElementById(this.dataset.target).remove();
                    })
                }

                let inputsUrl = document.querySelectorAll('.url-image');

                for (i=0 ; i<inputsUrl.length ; i++){
                    inputsUrl[i].addEventListener('input',function (e){
                        let target = 'img_'+this.getAttribute('id');
                        let img = new Image();
                        img.src = this.value;
                        img.onload = ()=>{
                            console.log('load');
                            document.getElementById(target).setAttribute('src',this.value)
                        }


                    })
                }


            }


        });

    </script>

{% endblock %}

{% block _project_pictures_widget %}
    <h3 class="mt-5">Liste des images associées à ce projet</h3>
    <button id="add-image"  type="submit" class="mt-3 mb-5"><i class="fas fa-plus"></i> Ajouter une image</button>

    {{ form_widget(form) }}


{% endblock %}

{% block _project_pictures_entry_widget %}

    <div id="block_{{ id }}" class="row image_add mt-5" >
        <div class="offset-1 col-11">
            <div class=" d-flex align-items-center">
                <div class="section-contact__icon-input d-flex justify-content-center align-items-center">
                    <i class="fas fa-heading"></i>
                </div>
                <label for="nom" class="d-inline w-100">
                    {{ form_widget(form.title) }}
                </label>
            </div>

        </div>
        <div class="offset-1 col-11">

            <div class=" d-flex align-items-center">
                <div class="section-contact__icon-input d-flex justify-content-center align-items-center">
                    <i class="fas fa-low-vision"></i>
                </div>
                <label for="nom" class="d-inline w-100">
                    {{ form_widget(form.alt) }}
                </label>
            </div>

        </div>
        <div class="offset-1 col-11">

            <div class=" d-flex align-items-center">
                <div class="section-contact__icon-input d-flex justify-content-center align-items-center">
                    <i class="fas fa-link"></i>
                </div>
                <label for="nom" class="d-inline w-100">
                    {{ form_widget(form.url) }}
                </label>
            </div>

        </div>
        <div class="offset-1 col-6">


            <img id="img_{{ id }}_url" src="{% if form.vars['value'] is not null %}{{ form.vars['value'].url }}{% endif %}" alt="" class="img-fluid">
        </div>
        <div class="offset-1 col-11">
            <div class=" d-flex ">
                <div class="section-contact__icon-input section-contact__icon-input--textarea d-flex justify-content-center align-items-center">
                    <i class="far fa-edit"></i>
                </div>
                <label for="nom" class="d-inline w-100">
                    {{ form_widget(form.description) }}
                </label>
            </div>
            <button data-target="block_{{ id }}" type="button" class="mt-3 mb-5 del-image" style="background-color: #ff2b2b"><i class="fas fa-trash-alt"></i> Supprimer cette image</button>
        </div>
    </div>



{% endblock %}

{% block _project_pictures_entry_row %}

    {{ form_widget(form) }}

{% endblock %}
